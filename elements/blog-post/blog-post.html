<dom-module id="blog-post">
    <template>
        <style>
            :host {
                display: none;
                position: absolute;
            }

            paper-card {
                width: 80%;
                /*margin-top: -150px;*/
                z-index: 1;
            }

            .paper-card-container {
                padding: 50px 40px;
            }

            .title {
                color: var(--default-primary-color);
                font-size: 42px;
            }

            .posted {
                font-size: 14px;
                color: var(--secondary-text-color);
            }
        </style>
        <iron-ajax id="ajax" url="[[postUrl]]" handle-as="text" on-response="postLoaded"></iron-ajax>
        <div class="relative layout horizontal center-justified">
            <paper-card>
                <div class="paper-card-container">
                    <paper-button class="back-button self-start" on-tap="closePost">
                        <iron-icon icon="icons:arrow-back"></iron-icon> Back
                    </paper-button>
                    <div class="card-content">
                            <span class="title block">[[meta.title]]</span>
                            <span class="posted">Posted: <span>[[meta.posted]]</span></span>
                    </div>
                    <div class="card-content">
                        <marked-element markdown="[[post]]"></marked-element>
                    </div>
                </div>
            </paper-card>
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'blog-post',
        behaviors: [
            Polymer.NeonSharedElementAnimatableBehavior
        ],
        properties: {
            meta: {
                type: Object,
                observer: '_metaChanged'
            },
            animationConfig: {
                value: function() {
                    return {
                        'entry': {
                            name: 'transform-animation',
                            node: this,
                            transformFrom: 'translateY(100vh)',
                            transformTo: 'none',
                            timing: {
                                duration: 1000
                            }
                        },
                        'exit': {
                            name: 'transform-animation',
                            node: this,
                            transformFrom: 'none',
                            transformTo: 'translateY(100vh)',
                            timing: {
                                duration: 1000
                            }
                        }
                    };
                }
            },
            closing: {
                type: Boolean,
                notify: true
            }
        },
        _metaChanged: function() {
            this.postUrl = '../../posts/' + this.meta.file;
            this.style.display = 'block';
            this.$.ajax.generateRequest();
        },
        postLoaded: function(event, response) {
            this.post = response.response;
            this.style.position = 'relative';
        },
        closePost: function() {
            this.closing = true;
        }
    });
</script>
